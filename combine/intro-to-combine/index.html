<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Swift Refresher"/><link rel="canonical" href="https://swiftrefresher.com/combine/intro-to-combine"/><meta name="twitter:url" content="https://swiftrefresher.com/combine/intro-to-combine"/><meta name="og:url" content="https://swiftrefresher.com/combine/intro-to-combine"/><title>Combine 101: Introduction | Swift Refresher</title><meta name="twitter:title" content="Combine 101: Introduction | Swift Refresher"/><meta name="og:title" content="Combine 101: Introduction | Swift Refresher"/><meta name="description" content="Getting into some reactive programming"/><meta name="twitter:description" content="Getting into some reactive programming"/><meta name="og:description" content="Getting into some reactive programming"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Swift Refresher"/></head><body class="bg-white font-sans leading-normal tracking-normal"><div class="pb-16"><nav class="fixed z-10 bg-gray-900 p-4 mt-0 w-full overflow-auto scrolling-touch"><div class="container mx-auto flex items-center"><div class="flex-shrink-0 text-white font-extrabold"><a class="flex text-white text-base no-underline hover:text-white hover:no-underline" href="/"><span class="block md:hidden md:w-auto pl-1">üèù</span><span class="hidden md:block w-0 md:w-auto pl-1">Swift Refresher</span></a></div><div class=" flex flex-no-wrap pl-4 text-sm"><ul class="list-reset flex justify-between items-center"><li class="mr-2"><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2" href="/">HOME</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/leetcode">LEETCODE</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/SwiftUI">SWIFTUI</a></li><li><a class="inline-block py-2 px-2 text-white no-underline hover:underline whitespace-no-wrap" href="/combine">COMBINE</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/swift">SWIFT</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-2 whitespace-no-wrap" href="/about">ABOUT</a></li></ul></div></div></nav></div><div class="text-center pt-16 md:pt-32"><p class="text-xs md:text-sm text-casper-blue font-bold">21 JUNE 2022<span class="text-gray-900 px-1">/</span><a href="/tags/swiftui">SWIFTUI</a>, <a href="/tags/combine">COMBINE</a></p><h1 class="font-bold break-normal text-3xl md:text-5xl max-w-6xl mx-auto">Combine 101: Introduction</h1></div><div class="container max-w-5xl mx-auto "><div class="mx-0 sm:mx-6"><main class="bg-white w-full p-8 md:p-24 text-gray-800 leading-normal"><article class="prose prose-sm sm:prose-xl break-words"><h1>Combine 101: Introduction</h1><p>If you have been around in the Swift world for a long time, or you are new to iOS development, odds are you have heard of the Combine framework. The combine framework was introduced by Apple at WWDC19, and was Apple's native answer to RxSwift, ReactiveSwift or any other functional reactive programming frameworks you may have heard of/used before.</p><h3>So what is it?</h3><p>Combine is a first party, <em>declarative</em> framework for asynchronous processing values (streams of data) over time. Instead of having multiple callbacks, completion handlers, or delegations, you can create a singular processing chain for your stream of data.</p><p>The key part here is the framework is declarative, meaning you describe what the program does &amp; not the flow of control. This is compared to imperative styles of programming where our code is how the program works &amp; implementing tasks to mutate some state. <em>Combine</em> is has functional reactive principles as well. This means our program reacts to each stream of data, and is based in functions with a set input &amp; set output. As you will see in some code examples, Combine is both declarative, functional and reactive because our data flows from one function to another, with each function having a defined input and output.</p><p>We can think of Combine having 3 main players: Publishers, Subscribers, and Operators. Let's get familiar with each one!</p><h2>Publishers</h2><p>The Publisher type, is a protocol defined in Swift. Swift Publishers are used to transmit sequences of values over time. You can think of this as a man shouting information from a rooftop at intermittent periods of time. He is a publisher.<br><br>Publishers have 2 associatedtypes representing the Output of the Publisher, and how the Publisher will fail. We can define each of these. Also the Publisher protocol has a <code>receive(subscriber:)</code> function hook a subscriber up to itself. Per the contract for the this function, a publisher‚Äôs output must match subscriber‚Äôs input, and so should the failure types.</p><p>Most Swift foundation objects/functions support built in publishers as of 2022. For example, NotificationCenter &amp; NSTimer:</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">notificationPublisher</span> <span class="p">=</span> <span class="n">NotificationCenter</span><span class="p">.</span><span class="n">Publisher</span><span class="p">(</span><span class="n">center</span><span class="p">:</span> <span class="p">.</span><span class="k">default</span><span class="p">,</span> 
                                                         <span class="n">name</span><span class="p">:</span> <span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">),</span> 
                                                         <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">timerPublisher</span> <span class="p">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">TimerPublisher</span><span class="p">(</span><span class="n">interval</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
                                          <span class="n">runLoop</span><span class="p">:</span> <span class="n">RunLoop</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> 
                                          <span class="n">mode</span><span class="p">:</span> <span class="p">.</span><span class="k">default</span><span class="p">)</span>
</div></code></pre><p>We have created these objects and now they can stream and emit values over time, we can also react to these values however we wish.</p><p>As opposed to creating our own objects that implement the Publisher protocol, Apple suggests we use one of their built-in types whenever we need a custom publisher. We can either:</p><ol><li>Use a concrete subclass of <code>Subject</code> like <code>PassThroughSubject</code> for example, to manually send values</li><li>Use a <code>CurrentValueSubject</code></li><li>Add the <code>@Published</code> annotation wrapper to a property we wish</li></ol><h3>What are Subjects?</h3><p>A subject is a type of Publisher that exposes functions, in order for outside callers to Publish events into the stream of data. Swift gives us 2 built-in Subjects for free. These are namely <em>CurrentValueSubject</em> and <em>PassThroughSubject</em>.</p><p>A <em>CurrentValueSubject</em> starts with an initial value, and publishes every time that value changes. We can also access the inner value with this type of Subject.</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="s">&quot;Test&quot;</span><span class="p">)</span> <span class="c1">// initial value of Test</span>

<span class="bp">print</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="c1">// prints &#39;Test&#39;</span>

<span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Blog&quot;</span><span class="p">)</span>
<span class="bp">print</span><span class="p">(</span><span class="n">subject</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="c1">// prints &#39;Blog&#39;</span>
</div></code></pre><p>A <em>PassThroughSubject</em> does not have an initial value, but broadcasts data downstream. This type also drops values if there are no subscribers, or the current demand is zero. We are unable to access any values within this object.</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// no initial value</span>

<span class="c1">// subscribe to events</span>
<span class="n">subject</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;finished&quot;</span><span class="p">)</span>
<span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Alex&quot;</span><span class="p">)</span>
<span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;is Blogging!&quot;</span><span class="p">)</span> 
<span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span> <span class="c1">// done!</span>
<span class="c1">// Alex</span>
<span class="c1">// is Blogging!</span>
<span class="c1">// finished</span>
</div></code></pre><h3>@Published property wrapper</h3><p>Swift allows us to add a publisher to any property by using the <em>@Published</em> property wrapper. You can access the inner publisher by using the <code>$</code> symbol in front of your property. It is important to note the @Published property wrapper is class-constrained, we cannot use them in structs. Let's see a code example (Note, we will learn about AnyCancellable soon!)</p><pre><code><div class="highlight"><span></span><span class="kr">final</span> <span class="kd">class</span> <span class="nc">FooClass</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">subscriber</span><span class="p">:</span> <span class="n">AnyCancellable</span><span class="p">?</span>
    <span class="p">@</span><span class="n">Published</span> <span class="kd">var</span> <span class="nv">isOn</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">=</span> <span class="kc">false</span> <span class="c1">// published</span>
    
    <span class="kd">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// this will print false, then true</span>
        <span class="n">subscriber</span> <span class="p">=</span> <span class="err">$</span><span class="n">isOn</span>
            <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
                <span class="bp">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">})</span>
       <span class="n">change</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">change</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">isOn</span><span class="p">.</span><span class="n">toggle</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</div></code></pre><p>Also worth noting, the publishing will happen in the object's willSet block, so anyone downstream will get the new value before it is set.</p><h2>Subscribers</h2><p>Up until now we have been referring to those listening to publishers as "Downstream". But they have a formal name, and that name is <em>Subscriber</em>. A Subscriber listens to events sent from a Publisher. A subscriber can receive either an input value, or a completion value with some indicator of a success/failure.</p><p>Swift gives us 2 built in Subscribers: <em>Subscribers.Sink</em> &amp; <em>Subscribers.Assign</em>.</p><p><em>Subscribers.Sink</em> is a simple Subscriber class that requests an unlimited amount of values upon its subscription.</p><p><em>Subscribers.Assign</em> assigns received elements to a property indicated by a key path.</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="n">Just</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

<span class="n">publisher</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;finished&quot;</span><span class="p">)</span>
<span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// false</span>
<span class="c1">// finished</span>
</div></code></pre><h2>Publisher + Subscriber Lifecycle</h2><p>Let's explore what happens under the hood when we build a subscription between a publisher &amp; subscriber</p><pre><code><div class="highlight"><span></span><span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

<span class="kd">let</span> <span class="nv">token</span> <span class="p">=</span> <span class="n">subject</span>
    <span class="p">.</span><span class="bp">print</span><span class="p">()</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&quot;received by subscriber: </span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span> <span class="p">})</span>

<span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">// receive subscription: (PassthroughSubject) [Subscriber connects to a publisher] [Publisher creates a subscription] [Publisher acknowledges subscription request]</span>
<span class="c1">// request unlimited [Subscriber requests number of elements it want to receive] [Our Demand is currently unlimited]</span>
<span class="c1">// receive value: (1) [The Publisher sends values by calling receive(_:) on the subscriber]</span>
<span class="c1">// received by subscriber: 1 [Returns how many items are expected to be received] [Subscriber can only increase or leave demand the same]</span>
<span class="c1">// receive cancel [Subscription either ends in a cancel, successful finish, or fail with an error]</span>
</div></code></pre><h1>Conclusion</h1><p>This concludes our intro into combine! Hope you learned a good foundation for our next few articles!</p><h4>Helpful links:</h4><p><a href="https://developer.apple.com/videos/play/wwdc2019/722/">WWDC19 Intro video</a></p></article></main><div class="flex flex-wrap w-full items-center font-sans p-8 md:p-24"><div class="md:flex-1 flex"><img class="w-10 h-10 rounded-full mr-4" src="https://asteezy24.github.io/assets/images/image01.jpg" alt="Alex Stevens"/><div class="flex-1"><p class="text-base font-bold text-base md:text-xl leading-none">Alex Stevens</p><p class="text-gray-600 text-xs md:text-base">iOS Software Engineer</p></div></div><div class="mt-8 md:mt-0 mx-auto md:mx-0 md:justify-end"><a class="bg-transparent border border-gray-500 hover:border-casper-blue text-xs text-gray-500 hover:text-casper-blue font-bold py-2 px-4 rounded-full" href="/tags">All tags</a></div></div></div></div><div class="bg-gray-200"><div class="container w-full max-w-6xl mx-auto px-2 py-8"><div class="grid grid-cols-1 sm:grid-cols-3 gap-12"><div class="w-full  py-6 flex flex-col flex-grow flex-shrink transform transition duration-200 ease-in-out hover:scale-105"><div class="flex-1 bg-white rounded-t rounded-b-none overflow-hidden shadow-lg"><a href="/combine/combine-201" class="flex flex-wrap no-underline hover:no-underline"><p class="w-full text-casper-blue text-xs font-medium pt-6 px-6">SWIFTUI, COMBINE</p><div class="w-full font-bold text-2xl text-gray-900 px-6">Combine 201: Diving a little deeper</div><p class="text-gray-800 font-serif text-lg px-6 mb-5">Taking our combine knowledge a little further</p></a></div><div class="flex-none mt-auto bg-white rounded-b rounded-t-none overflow-hidden shadow-lg p-6"><div class="flex items-center justify-between"><img class="w-8 h-8 rounded-full mr-4 avatar" src="https://asteezy24.github.io/assets/images/image01.jpg" alt="Alex Stevens"/><p class="text-gray-600 text-xs md:text-sm">9 MIN READ</p></div></div></div></div></div></div><footer class="bg-gray-900"><div class="container max-w-6xl mx-auto flex items-center px-2 pt-2 pb-8"><div class="w-full mx-auto flex flex-wrap items-center"><div class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"><p><a class="text-gray-900 no-underline hover:text-gray-900 hover:no-underline" href="#"><span class="text-base text-gray-200">Swift Refresher</span></a></p></div><div class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"><ul class="list-reset flex justify-center flex-1 md:flex-none items-center"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="/">Latest Posts</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://github.com/JohnSundell/Publish">Publish</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline py-2 px-3 text-sm" href="https://ghost.org">Ghost</a></li><li><a class="inline-block text-gray-600 no-underline hover:text-gray-200 hover:underline px-3 text-sm" href="/feed.rss"><svg class="fill-current h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"></circle><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"></path></svg></a></li></ul></div></div></div></footer></body></html>